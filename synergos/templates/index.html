<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synergos - Interview Co-Pilot</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Add Microsoft Cognitive Services Speech SDK -->
    <script src="https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk@latest/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            font-size: 0.9rem; /* Smaller default font size */
        }
        .container-fluid { /* Use container-fluid for better width control */
            max-width: 1600px; /* Increased max-width */
            padding-left: 20px;
            padding-right: 20px;
        }
        .card {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08); /* Softer shadow */
            border-radius: 8px; /* Slightly reduced radius */
            border: 1px solid #e9ecef; /* Subtle border */
            margin-bottom: 20px;
            height: 100%; /* Make cards fill column height where appropriate */
            display: flex; /* Enable flex for card body growth */
            flex-direction: column; /* Stack header/body vertically */
        }
        .card-header {
            background-color: #f8f9fa; /* Lighter header */
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
            font-size: 0.9rem; /* Adjusted header font */
            padding: 0.6rem 1rem; /* Adjusted padding */
        }
        .card-body {
           flex-grow: 1; /* Allow card body to expand */
           overflow-y: auto; /* Add scroll to body if content overflows */
           padding: 0.8rem 1rem; /* Adjusted padding */
        }

        /* Header Area Styles */
        .header-section {
            background-color: #ffffff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }
        .header-section .form-label {
            font-size: 0.8rem;
            margin-bottom: 0.2rem;
        }
        .header-section .form-control, .header-section .btn {
            font-size: 0.85rem;
            padding: 0.25rem 0.5rem;
        }
        .header-section h5 {
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: #343a40;
        }
        .interview-controls-header {
            text-align: right;
        }
        .interview-controls-header .btn {
            margin-left: 5px;
        }

        /* Main Content Columns - Ensure equal height */
        .main-content-row > [class*='col-'] {
            display: flex;
            flex-direction: column;
        }
         .main-content-row .card {
            flex-grow: 1; /* Make cards in columns expand */
        }
        
        /* Specific Card Height Adjustments */
         #candidate_transcript_box {
            min-height: 200px; /* Ensure minimum height */
            max-height: 60vh; /* Limit maximum height relative to viewport */
            overflow-y: auto;
            font-size: 0.85rem; /* Slightly smaller transcript text */
         }
        #selected_questions_box, #question_box {
             min-height: 150px;
             max-height: 35vh; /* Limit height */
             overflow-y: auto;
        }
         #response_summary_box, #followup_questions_container {
            min-height: 100px;
             max-height: 30vh; /* Limit height */
             overflow-y: auto;
         }
         #followup_questions_container {
             margin-top: 15px;
             padding-top: 15px;
             border-top: 1px dashed #dee2e6;
         }
         #response_summary_box p:first-child {
             margin-top: 0;
         }


        .btn-primary { background-color: #0d6efd; border-color: #0d6efd; }
        .btn-success { background-color: #198754; border-color: #198754; }
        .btn-danger { background-color: #dc3545; border-color: #dc3545; }
        .btn-warning { background-color: #ffc107; border-color: #ffc107; }
        .btn-info { background-color: #0dcaf0; border-color: #0dcaf0; color: #000; } /* Better contrast for info */

        #recordingIndicator { width: 15px; height: 15px; border-radius: 50%; background-color: #ccc; display: inline-block; margin-left: 10px; vertical-align: middle; }
        #recordingIndicator.recording { background-color: #dc3545; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .question { cursor: pointer; padding: 6px 10px; margin: 4px 0; border-radius: 5px; transition: all 0.2s; background-color: #f8f9fa; border: 1px solid #dee2e6; }
        .question:hover { background-color: #e9ecef; }
        .selected-question-item { padding: 6px 10px; margin: 4px 0; background-color: #f8f9fa; border-left: 4px solid #6c757d; border-radius: 4px; transition: all 0.2s; }
        .selected-question-item:hover { background-color: #e9ecef; }
        .selected-question-item.active { border-left: 4px solid #0d6efd; background-color: #e7f1ff; }
        .selected-question-item.asked { border-left: 4px solid #28a745; background-color: #e2f3e7; } /* Adjusted asked color */
        .btn-thumbs { padding: 0.1rem 0.3rem; font-size: 0.7rem; margin-left: 5px; }

        .status-message { padding: 8px 12px; border-radius: 5px; margin-bottom: 10px; font-size: 0.85rem; }
        .info { background-color: #cff4fc; color: #055160; border: 1px solid #9eeaf9;}
        .success { background-color: #d1e7dd; color: #0f5132; border: 1px solid #a3cfbb;}
        .warning { background-color: #fff3cd; color: #664d03; border: 1px solid #ffe69c;}
        .danger { background-color: #f8d7da; color: #842029; border: 1px solid #f1aeb5;}

        #processingIndicator { display: none; position: fixed; /* Use fixed for overlay */ top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); /* Darker overlay */ display: flex; justify-content: center; align-items: center; z-index: 1050; /* Ensure it's above other elements */ }
        #processingIndicator > div { background-color: white; padding: 30px; border-radius: 8px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .spinner-border { width: 3rem; height: 3rem; color: #0d6efd; }

        /* Speaker differentiation styles */
        .interviewer-text { color: #4a6da7; font-weight: 500; }
        .candidate-text { color: #2e7d32; }
        .check-mark { color: green; margin-left: 10px; }

        /* STAR analysis styles */
        .star-category { font-weight: bold; margin-top: 8px; font-size: 0.85rem; color: #343a40;}
        .star-content { margin-left: 15px; margin-bottom: 8px; font-size: 0.8rem; }
        
        /* Job Analysis Section Styles */
        .job-analysis-section { background-color: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08); margin-bottom: 20px; overflow: hidden; border: 1px solid #e9ecef; }
        .job-analysis-header { padding: 10px 15px; background-color: #f8f9fa; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center; }
        .job-analysis-title { margin-bottom: 0; font-size: 1rem; font-weight: 600; }
        .job-analysis-body { max-height: 300px; overflow-y: auto; padding: 15px; }
        .competency-header { font-size: 0.9rem; color: #0d6efd; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #e0e0e0; }
        .responsibility-item { margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px dotted #e0e0e0; &:last-child { border-bottom: none; } } /* Use pseudo-class */
        .responsibility-text { margin-bottom: 5px; font-size: 0.82rem; line-height: 1.4; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
        .competency-tag { background-color: #e7f1ff; color: #0d6efd; padding: 3px 8px; border-radius: 10px; font-size: 0.75rem; display: inline-block; margin-right: 4px; margin-bottom: 4px; }
        .position-summary { margin-bottom: 15px; padding: 10px; background-color: #f8f9fa; border-radius: 5px; border: 1px solid #e9ecef;}
        .section-divider { margin: 15px 0; border-top: 1px dashed #e0e0e0; }
        
        /* Transcript styles */
        .left-transcript p { margin-bottom: 0.5rem; } /* Spacing between transcript entries */
        
        .followup-question { background-color: #f8f9fa; padding: 6px 10px; margin: 4px 0; border-radius: 6px; cursor: pointer; transition: background-color 0.2s; font-size: 0.85rem; border: 1px solid #dee2e6;}
        .followup-question:hover { background-color: #e9ecef; }
        
        /* Competency group styling */
        .competency-group { border-left: 3px solid #6c757d; padding-left: 10px; margin-bottom: 12px; }
        .competency-title { color: #0d6efd; font-size: 0.9rem; font-weight: 600; margin-bottom: 6px; }
        .competency-group .question { margin-left: 0; } /* Remove margin as padding is on group */
        .competency-group:nth-child(odd) { border-left-color: #0d6efd; }
        .competency-group:nth-child(even) { border-left-color: #198754; }
        .competency-group:nth-child(odd) .competency-title { color: #0d6efd; }
        .competency-group:nth-child(even) .competency-title { color: #198754; }
        
        /* Primary question styling */
        .primary-question { border-left: 3px solid #0d6efd; background-color: #e7f1ff; /* Highlight primary */ }
        strong { font-weight: 600; } /* Ensure bold is noticeable */

        /* Make cards in the middle/right columns scroll independently */
         .scrollable-card .card-body {
             max-height: calc(50vh - 60px); /* Adjust based on desired height, subtracting header/padding */
             overflow-y: auto;
         }

         /* Remove default list styling */
         ul {
             list-style: none;
             padding-left: 0;
         }

         h1 {
            font-size: 1.75rem;
            color: #343a40;
         }
         #phaseIndicator {
            font-size: 0.9rem;
            color: #6c757d;
         }
    </style>
</head>
<body>
    <div class="container-fluid py-3">
        <!-- Header Row -->
        <div class="row mb-3 header-section align-items-center">
            <!-- Left Side: Uploads -->
            <div class="col-md-7">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Upload Resume</h5>
                        <form id="resumeForm">
                            <div class="mb-2">
                                <label for="resumeFile" class="form-label visually-hidden">Candidate Resume</label>
                                <input class="form-control" type="file" id="resumeFile" name="resume" accept=".pdf,.doc,.docx,.txt">
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Upload Resume</button>
                        </form>
                    </div>
                    <div class="col-md-6">
                         <h5>Upload Job Description</h5>
                        <!-- File upload option -->
                        <form id="jobPostingForm" class="mb-2">
                            <div class="mb-2">
                                <label for="jobPostingFile" class="form-label visually-hidden">Upload Job Posting</label>
                                <input class="form-control" type="file" id="jobPostingFile" name="job_posting" accept=".pdf,.doc,.docx,.txt">
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Upload Job Posting</button>
                        </form>
                         <!-- URL option -->
                        <form id="jobUrlForm">
                            <div class="mb-2">
                                <label for="jobUrl" class="form-label visually-hidden">Or Enter Job Posting URL</label>
                                <input type="url" class="form-control" id="jobUrl" name="job_url" placeholder="Or Paste Job Posting URL">
                            </div>
                            <button type="submit" class="btn btn-secondary w-100">Process URL</button>
                        </form>
                    </div>
                </div>
            </div>
            <!-- Right Side: Controls -->
            <div class="col-md-5 interview-controls-header">
                 <h1 class="mb-0 d-inline-block me-3" style="font-size: 1.5rem; vertical-align: middle;">Interview Co-Pilot</h1>
                 <button type="button" class="btn btn-outline-secondary btn-sm me-2" data-bs-toggle="modal" data-bs-target="#configModal">
                     <i class="fas fa-cog"></i> Configure API Keys
                 </button>
                 <span id="phaseIndicator" class="me-2">
                    Phase: <span id="currentPhase">Not Started</span>
                 </span>
                 <span id="recordingIndicator"></span>
                 <hr class="my-2">
                 <button id="start" class="btn btn-success"><i class="fas fa-microphone"></i> Start</button>
                 <button id="stop" class="btn btn-danger" disabled><i class="fas fa-stop"></i> End</button>
                 <button id="testDemoButton" class="btn btn-info"><i class="fas fa-vial"></i> Test Demo</button>
                 <button id="evernorthDemoButton" class="btn btn-warning"><i class="fas fa-building"></i> Evernorth Demo</button>
                 <div class="mt-2 text-muted small d-flex justify-content-between align-items-center">
                    <span>Selected Questions: <span id="questionCount">0</span></span>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="autoAdvanceToggle">
                        <label class="form-check-label small text-muted" for="autoAdvanceToggle">Auto-advance</label>
                    </div>
                 </div>
            </div>
        </div>

        <!-- Status Messages Area -->
        <div id="statusMessages" class="mb-3"></div>
        
        <!-- Job Analysis Section (Full Width) -->
        <div id="jobAnalysisSection" class="job-analysis-section mb-3" style="display: none;">
            <div class="job-analysis-header">
                <h5 class="job-analysis-title">Job Requirements - Competencies Analysis</h5>
                <button id="toggleJobAnalysis" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </div>
            <div class="job-analysis-body">
                <div id="jobResponsibilitiesList"></div>
            </div>
        </div>

        <!-- Main Content Area - Three Columns -->
        <div class="row main-content-row">
            <!-- Left Column: Transcript & Resume Overview -->
            <div class="col-md-3">
                 <!-- *** MOVED UP: Resume Overview Card *** -->
                 <div class="card mb-3" id="resumeOverviewCard" style="display: none;"> 
                    <div class="card-header">Resume Overview</div>
                    <div class="card-body">
                        <div id="resume_overview_box">
                            <p class="text-muted">Resume overview will appear here after upload.</p>
                        </div>
                    </div>
                </div>
                 <!-- *** END Resume Overview Card *** -->

                 <!-- *** MOVED DOWN: Transcript Card *** -->
                <div class="card"> 
                    <div class="card-header">Candidate Transcript</div>
                    <div class="card-body p-2">
                        <div id="candidate_transcript_box" class="p-2" style="border: 1px solid #ddd; border-radius: 5px;">
                           <!-- Transcript content goes here -->
                        </div>
                    </div>
                </div>
                 <!-- *** END Transcript Card *** -->
            </div>

            <!-- Middle Column: Questions -->
            <div class="col-md-5">
                 <!-- *** REORDERED: Selected Questions First *** -->
                 <div class="card mb-3 scrollable-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>Selected Questions</span>
                    </div>
                    <div class="card-body">
                        <ul id="selected_questions_box">
                            <li class="text-muted">No questions selected yet. Click on suggested questions to add them here.</li>
                        </ul>
                    </div>
                </div>
                 <!-- *** REORDERED: Resume Questions Second *** -->
                 <div class="card mb-3 scrollable-card" id="resumeQuestionsCard" style="display: none;"> 
                    <div class="card-header">Resume-Based Questions</div>
                    <div class="card-body">
                        <div id="resume_question_box">
                            <p class="text-muted">Resume-specific questions will appear here after upload.</p>
                        </div>
                    </div>
                </div>
                 <!-- *** END REORDER *** -->

                 <div class="card scrollable-card">
                     <div class="card-header d-flex justify-content-between align-items-center">
                        <span>Suggested Questions</span>
                        <!-- Search Input -->
                        <input type="search" id="searchSuggestedQuestions" class="form-control form-control-sm ms-3 me-2" placeholder="Search questions..." style="max-width: 200px;">
                        <button id="toggleSuggestedQuestions" class="btn btn-sm btn-outline-secondary" title="Toggle Suggested Questions">
                            <i class="fas fa-chevron-up"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="question_box">
                            <p class="text-muted">Upload a resume or job posting to get suggested questions.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Analysis -->
            <div class="col-md-4">
                <div class="card scrollable-card">
                    <div class="card-header">Response Analysis</div>
                    <div class="card-body">
                        <div id="response_summary_box">
                             <p class="text-muted">Analysis will appear here after candidate responds.</p>
                        </div>
                         <!-- Merged Follow-up Questions Container -->
                         <div id="followup_questions_container">
                            <h6 class="mt-3 mb-2" style="font-size: 0.9rem; color: #343a40;">Suggested Follow-up Questions</h6>
                            <p class="text-muted small">Follow-up questions will appear here.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Processing Indicator -->
    <div id="processingIndicator">
         <div>
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Processing...</span>
            </div>
            <div class="mt-2">Processing...</div>
        </div>
    </div>

    <!-- API Configuration Modal -->
    <div class="modal fade" id="configModal" tabindex="-1" aria-labelledby="configModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="configModalLabel">Configure API Keys</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="configStatus" class="alert alert-info" style="display: none;"></div>
                    <form id="configForm">
                        <div class="mb-3">
                            <label for="openaiApiKey" class="form-label">OpenAI API Key</label>
                            <input type="password" class="form-control" id="openaiApiKey" placeholder="sk-...">
                            <div class="form-text">Required for AI-powered features like competency analysis and question generation.</div>
                        </div>
                        <div class="mb-3">
                            <label for="awsAccessKey" class="form-label">AWS Access Key ID</label>
                            <input type="text" class="form-control" id="awsAccessKey" placeholder="AKIA...">
                            <div class="form-text">Optional - for storing data in DynamoDB.</div>
                        </div>
                        <div class="mb-3">
                            <label for="awsSecretKey" class="form-label">AWS Secret Access Key</label>
                            <input type="password" class="form-control" id="awsSecretKey" placeholder="">
                            <div class="form-text">Optional - for storing data in DynamoDB.</div>
                        </div>
                        <div class="mb-3">
                            <label for="awsRegion" class="form-label">AWS Region</label>
                            <select class="form-control" id="awsRegion">
                                <option value="us-east-1">US East (N. Virginia)</option>
                                <option value="us-west-2">US West (Oregon)</option>
                                <option value="eu-west-1">Europe (Ireland)</option>
                                <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveConfig">Save Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/interview-copilot.js"></script>
</body>
</html>